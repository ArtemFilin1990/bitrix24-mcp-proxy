# Bitrix24 MCP Proxy

[![CI](https://github.com/ArtemFilin1990/bitrix24-mcp-proxy/actions/workflows/ci.yml/badge.svg)](https://github.com/ArtemFilin1990/bitrix24-mcp-proxy/actions/workflows/ci.yml)
[![Security](https://github.com/ArtemFilin1990/bitrix24-mcp-proxy/actions/workflows/security.yml/badge.svg)](https://github.com/ArtemFilin1990/bitrix24-mcp-proxy/actions/workflows/security.yml)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

API-ะฟัะพะบัะธ ะดะปั ะฒัะฟะพะปะฝะตะฝะธั REST-ะผะตัะพะดะพะฒ Bitrix24 ัะตัะตะท MCP-ะบะพะฝะฝะตะบัะพั (ChatGPT Custom Actions).

## ๐ ะกะพะดะตัะถะฐะฝะธะต

- [ะะพะทะผะพะถะฝะพััะธ](#ะฒะพะทะผะพะถะฝะพััะธ)
- [ะัััััะน ััะฐัั](#ะฑัััััะน-ััะฐัั)
- [ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ](#ะปะพะบะฐะปัะฝะฐั-ัะฐะทัะฐะฑะพัะบะฐ)
- [ะัะฟะพะปัะทะพะฒะฐะฝะธะต ngrok](#ะธัะฟะพะปัะทะพะฒะฐะฝะธะต-ngrok)
- [ะะฝัะตะณัะฐัะธั ั ะพะฑะปะฐัะฝะพะน Bitrix24](#ะธะฝัะตะณัะฐัะธั-ั-ะพะฑะปะฐัะฝะพะน-bitrix24)
- [API Endpoints](#api-endpoints)
- [Docker](#docker)
- [ะขะตััะธัะพะฒะฐะฝะธะต](#ัะตััะธัะพะฒะฐะฝะธะต)
- [GitHub Secrets](#github-secrets)
- [ะะตะฟะปะพะน ะฝะฐ Vercel](#ะดะตะฟะปะพะน-ะฝะฐ-vercel)

## โจ ะะพะทะผะพะถะฝะพััะธ

- ๐ MCP-ัะพะฒะผะตััะธะผัะน ะฟัะพะบัะธ ะดะปั Bitrix24 REST API
- ๐ ะะพะดะดะตัะถะบะฐ OAuth ะธ Webhook ะฐััะตะฝัะธัะธะบะฐัะธะธ
- ๐ณ Docker-ready ั multi-stage ัะฑะพัะบะพะน
- ๐ฆ TypeScript ั ะฟะพะปะฝะพะน ัะธะฟะธะทะฐัะธะตะน
- ๐งช ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั
- ๐ CI/CD ั GitHub Actions

## ๐ ะัััััะน ััะฐัั

### ะขัะตะฑะพะฒะฐะฝะธั

- Node.js >= 18.0.0
- npm >= 9.0.0

### ะฃััะฐะฝะพะฒะบะฐ

```bash
# ะะปะพะฝะธัะพะฒะฐัั ัะตะฟะพะทะธัะพัะธะน
git clone https://github.com/ArtemFilin1990/bitrix24-mcp-proxy.git
cd bitrix24-mcp-proxy

# ะฃััะฐะฝะพะฒะธัั ะทะฐะฒะธัะธะผะพััะธ
npm ci

# ะกะบะพะฟะธัะพะฒะฐัั ัะฐะนะป ะพะบััะถะตะฝะธั
cp .env.example .env

# ะััะตะดะฐะบัะธัะพะฒะฐัั .env ัะฐะนะป ั ะฒะฐัะธะผะธ ะฝะฐัััะพะนะบะฐะผะธ
nano .env
```

## ๐ป ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

```bash
# ะฃััะฐะฝะพะฒะธัั ะทะฐะฒะธัะธะผะพััะธ
npm ci

# ะกะบะพะฟะธัะพะฒะฐัั ะธ ะฝะฐัััะพะธัั ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
cp .env.example .env

# ะะฐะฟัััะธัั ะฒ ัะตะถะธะผะต ัะฐะทัะฐะฑะพัะบะธ
npm run dev
```

ะกะตัะฒะตั ะฑัะดะตั ะดะพัััะฟะตะฝ ะฟะพ ะฐะดัะตัั: `http://localhost:3000`

### ะะพัััะฟะฝัะต ะบะพะผะฐะฝะดั

| ะะพะผะฐะฝะดะฐ                 | ะะฟะธัะฐะฝะธะต                                  |
| ----------------------- | ----------------------------------------- |
| `npm run dev`           | ะะฐะฟััะบ ะฒ ัะตะถะธะผะต ัะฐะทัะฐะฑะพัะบะธ ั hot-reload   |
| `npm run build`         | ะกะฑะพัะบะฐ TypeScript                         |
| `npm start`             | ะะฐะฟััะบ production-ัะตัะฒะตัะฐ                 |
| `npm run lint`          | ะัะพะฒะตัะบะฐ ะบะพะดะฐ ะปะธะฝัะตัะพะผ                    |
| `npm run lint:fix`      | ะะฒัะพะผะฐัะธัะตัะบะพะต ะธัะฟัะฐะฒะปะตะฝะธะต ะพัะธะฑะพะบ ะปะธะฝัะตัะฐ |
| `npm run format`        | ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต ะบะพะดะฐ                       |
| `npm test`              | ะะฐะฟััะบ ัะตััะพะฒ                             |
| `npm run test:coverage` | ะขะตััั ั ะฟะพะบัััะธะตะผ                         |
| `npm run typecheck`     | ะัะพะฒะตัะบะฐ ัะธะฟะพะฒ                            |

## ๐ ะัะฟะพะปัะทะพะฒะฐะฝะธะต ngrok

ะะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ ั ะฒะฝะตัะฝะธะผ ะดะพัััะฟะพะผ ะธัะฟะพะปัะทัะนัะต [ngrok](https://ngrok.com/):

1. **ะฃััะฐะฝะพะฒะธัั ngrok:**

   ```bash
   # macOS
   brew install ngrok

   # Ubuntu/Debian
   snap install ngrok

   # ะะปะธ ัะบะฐัะฐัั ั https://ngrok.com/download
   ```

2. **ะะฐะฟัััะธัั ะฟัะธะปะพะถะตะฝะธะต:**

   ```bash
   npm run dev
   ```

3. **ะ ะดััะณะพะผ ัะตัะผะธะฝะฐะปะต ะทะฐะฟัััะธัั ngrok:**

   ```bash
   ngrok http 3000
   ```

4. **ะัะฟะพะปัะทะพะฒะฐัั ะฟะพะปััะตะฝะฝัะน URL:**

   ```
   Forwarding: https://xxxx-xx-xx-xx-xx.ngrok-free.app -> http://localhost:3000
   ```

5. **ะะฑะฝะพะฒะธัั OpenAPI ัะฟะตัะธัะธะบะฐัะธั** ั ะฝะพะฒัะผ URL ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะฒ ChatGPT Custom Actions.

## โ๏ธ ะะฝัะตะณัะฐัะธั ั ะพะฑะปะฐัะฝะพะน Bitrix24

### ะกะพะทะดะฐะฝะธะต ะฟัะธะปะพะถะตะฝะธั ะฒ Bitrix24

1. ะะตัะตะนัะธ ะฒ **ะัะธะปะพะถะตะฝะธั** โ **ะะฐะทัะฐะฑะพััะธะบะฐะผ** โ **ะััะณะพะต** โ **ะะพะบะฐะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต**

2. ะะฐะฟะพะปะฝะธัั ัะพัะผั:
   - **ะะฐะทะฒะฐะฝะธะต ะฟัะธะปะพะถะตะฝะธั:** MCP Proxy
   - **ะัะฐะฒะฐ ะดะพัััะฟะฐ:** ะัะฑัะฐัั ะฝะตะพะฑัะพะดะธะผัะต (ะฝะฐะฟัะธะผะตั, `crm`, `task`)
   - **ะััั ะดะปั ะฟะตัะฒะพะฝะฐัะฐะปัะฝะพะน ัััะฐะฝะพะฒะบะธ:** `https://your-domain.com/install`
   - **ะััั ะดะปั ัะฐะฑะพัั ั ะฟัะธะปะพะถะตะฝะธะตะผ:** `https://your-domain.com/`

3. ะะพัะปะต ัะพััะฐะฝะตะฝะธั ะฟะพะปััะธัั:
   - `client_id` (ะะพะด ะฟัะธะปะพะถะตะฝะธั)
   - `client_secret` (ะกะตะบัะตัะฝัะน ะบะปัั)

### ะัะฟะพะปัะทะพะฒะฐะฝะธะต Webhook

ะะปััะตัะฝะฐัะธะฒะฝัะน ัะฟะพัะพะฑ โ ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะฒัะพะดััะตะณะพ webhook:

1. ะะตัะตะนัะธ ะฒ **ะัะธะปะพะถะตะฝะธั** โ **ะะตะฑััะบะธ** โ **ะะพะฑะฐะฒะธัั ะฒัะพะดััะธะน ะฒะตะฑััะบ**

2. ะัะฑัะฐัั ะฟัะฐะฒะฐ ะดะพัััะฟะฐ

3. ะกะบะพะฟะธัะพะฒะฐัั URL ะฒะตะฑััะบะฐ ะฒ ัะพัะผะฐัะต:

   ```
   https://your-domain.bitrix24.ru/rest/1/your_webhook_key/
   ```

4. ะะพะฑะฐะฒะธัั ะฒ `.env`:
   ```env
   B24_WEBHOOK_URL=https://your-domain.bitrix24.ru/rest/1/your_webhook_key/
   ```

## ๐ก API Endpoints

### GET /servers

ะะพะทะฒัะฐัะฐะตั ัะฟะธัะพะบ MCP-ัะตัะฒะตัะพะฒ.

**Response:**

```json
{
  "servers": [
    {
      "name": "bitrix24-mcp",
      "description": "MCP Proxy for Bitrix24",
      "url": "https://bitrix24-mcp-proxy.vercel.app/mcp"
    }
  ]
}
```

### POST /mcp

ะัะฟะพะปะฝัะตั ะฒัะทะพะฒ ะผะตัะพะดะฐ Bitrix24 ัะตัะตะท ะฟัะพะบัะธ.

**Request Body:**

```json
{
  "webhook": "https://example.bitrix24.ru/rest/1/KEY/",
  "method": "crm.deal.list",
  "params": {
    "select": ["ID", "TITLE"],
    "filter": { "STAGE_ID": "NEW" }
  }
}
```

**Response:**
ะะพะทะฒัะฐัะฐะตั ะพัะธะณะธะฝะฐะปัะฝัะน ะพัะฒะตั Bitrix24.

## ๐ณ Docker

### ะกะฑะพัะบะฐ ะธ ะทะฐะฟััะบ

```bash
# ะกะฑะพัะบะฐ ะพะฑัะฐะทะฐ
docker build -t bitrix24-mcp-proxy .

# ะะฐะฟััะบ ะบะพะฝัะตะนะฝะตัะฐ
docker run -p 3000:3000 --env-file .env bitrix24-mcp-proxy
```

### Docker Compose

```bash
# ะะฐะฟััะบ
docker-compose up -d

# ะััะฐะฝะพะฒะบะฐ
docker-compose down

# ะัะพัะผะพัั ะปะพะณะพะฒ
docker-compose logs -f
```

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

```bash
# ะะฐะฟััะบ ะฒัะตั ัะตััะพะฒ
npm test

# ะขะตััั ั ะฟะพะบัััะธะตะผ
npm run test:coverage
```

> **ะัะธะผะตัะฐะฝะธะต:** ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั ััะตะฑััั ะฝะฐัััะพะตะฝะฝะพะณะพ ะพะบััะถะตะฝะธั Bitrix24 ะธ ะผะพะณัั ะฝะต ะฟัะพัะพะดะธัั ะฑะตะท ัะตะฐะปัะฝัั credentials.

## ๐ GitHub Secrets

ะะปั ัะฐะฑะพัั CI/CD ะดะพะฑะฐะฒััะต ัะปะตะดัััะธะต ัะตะบัะตัั ะฒ ะฝะฐัััะพะนะบะฐั ัะตะฟะพะทะธัะพัะธั:

| Secret              | ะะฟะธัะฐะฝะธะต                                  |
| ------------------- | ----------------------------------------- |
| `DOCKER_USERNAME`   | ะะผั ะฟะพะปัะทะพะฒะฐัะตะปั Docker Hub (ะพะฟัะธะพะฝะฐะปัะฝะพ) |
| `DOCKER_PASSWORD`   | ะะฐัะพะปั Docker Hub (ะพะฟัะธะพะฝะฐะปัะฝะพ)           |
| `B24_CLIENT_ID`     | Client ID ะฟัะธะปะพะถะตะฝะธั Bitrix24             |
| `B24_CLIENT_SECRET` | Client Secret ะฟัะธะปะพะถะตะฝะธั Bitrix24         |

> **ะัะธะผะตัะฐะฝะธะต:** `GITHUB_TOKEN` ะฟัะตะดะพััะฐะฒะปัะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะธ ะธัะฟะพะปัะทัะตััั ะดะปั GHCR.

## ๐ ะะตะฟะปะพะน ะฝะฐ Vercel

1. ะกะพะทะดะฐัั GitHub ัะตะฟะพะทะธัะพัะธะน

2. ะะฐะปะธัั ัะฐะนะปั ะฟัะพะตะบัะฐ

3. ะะฐะทะฒะตัะฝััั ัะตัะตะท https://vercel.com/new

4. ะัะฟะพะปัะทะพะฒะฐัั URL:
   ```
   https://PROJECT.vercel.app/servers
   ```

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
/
โโโ api/                    # Vercel API routes
โ   โโโ mcp.js
โ   โโโ servers.js
โโโ src/                    # TypeScript ะธััะพะดะฝะธะบะธ
โ   โโโ index.ts
โ   โโโ config/
โ   โโโ utils/
โ   โโโ bitrix24/
โ   โโโ tools/
โโโ tests/                  # ะขะตััั
โโโ .github/                # GitHub Actions ะธ ัะฐะฑะปะพะฝั
โ   โโโ workflows/
โ   โโโ ISSUE_TEMPLATE/
โโโ openapi.json
โโโ vercel.json
โโโ Dockerfile
โโโ docker-compose.yml
โโโ package.json
โโโ README.md
```

## ๐ ะะธัะตะฝะทะธั

MIT License - ัะผ. ัะฐะนะป [LICENSE](LICENSE)

## ๐ค ะะบะปะฐะด ะฒ ะฟัะพะตะบั

ะั ะฟัะธะฒะตัััะฒัะตะผ ะฒะบะปะฐะด ะฒ ะฟัะพะตะบั! ะกะผ. [CONTRIBUTING.md](CONTRIBUTING.md) ะดะปั ะดะตัะฐะปะตะน.

## ๐ ะะพะดะดะตัะถะบะฐ

- [ะกะพะทะดะฐัั Issue](https://github.com/ArtemFilin1990/bitrix24-mcp-proxy/issues)
- [ะะพะบัะผะตะฝัะฐัะธั Bitrix24 REST API](https://dev.1c-bitrix.ru/rest_help/)
